# OSI 7계층
- 네트워크 기술의 기본이 되는 모델.
- 데이터를 전송하는 송신 측은 데이터를 보내기 위해 상위 계층에서 하위 계층으로 데이터를 전달한다.
- 각 계층은 독립적이다.
- 데이터를 받는 수신 측은 하위 계층에서 상위 계층으로 전달된 데이터를 받는다.
- 각각의 계층에는 다양한 프로토콜이 있다.
- 데이터를 전송할 때는, 데이터 전송에 필요한 정보를 붙여서 다음 계층으로 보내야 하는데, 이 정보를 헤더라고 한다. 헤더에는 데이터를 전송받을 상대방에 대한 정보도 포함되어 있다.
    - 이렇게 헤더를 붙여 나가는 것을 캡슐화라고 한다.

## 구성
- 물리 계층 (Physical Layer)
- 데이터 링크 계층 (Data Link Layer)
- 네트워크 계층 (Network Layer)
- 전송 계층 (Transport Layer)
- 세션 계층 (Session Layer)
- 표현 계층 (Presentation Layer)
- 응용 계층 (Application Layer)

## 물리 계층
- 데이터를 전기 신호로 변환해 전달한다.
- 물리 계층에 도착하기 전 데이터는 이미 0과 1로 변환되어 있어야 한다.
- 단순 전달의 역할을 수행하다 보니, 오류 수정 등의 기능은 없다.
- 관련 장비로 케이블, 리피터, 허브가 있다.

## 데이터 링크 계층: 프레임
- 네트워크 장비 간에 신호를 주고받는 규칙을 정하는 계층.
- 물리적 연결을 통한 신뢰도 있는 연결을 담당한다. Point-To-Point 
- 보내려는 데이터에 목적지 정보(MAC 주소)를 추가해서, 목적지 이외의 컴퓨터는 데이터를 받더라도 무시하게 한다.
  - 참고. MAC 주소는 물리 주소. 전 세계에서 유일한 주소이다.
    - 48비트 숫자로 이루어져 있다. 한 자리당 16진수(4바이트)인 셈.
  - 데이터를 받고도 무시하게 하는 이유는, 스위치는 브로드캐스트 방식으로 데이터를 전송하기 때문.
- 데이터 링크 계층에서는 이더넷 헤더와 트레일러를 붙인다.
  - 이더넷 헤더는 목적지의 맥 주소 6바이트, 출발지 맥 주소 6바이트, 유형 2바이트의 총 14바이트로 구성되어 있다.
- 관련 장비로 스위치, 브릿지가 있다.

## 네트워크 계층: 패킷
- 네트워크 간의 통신을 가능하게 하는 역할.
- 중계 노드를 통해 데이터를 전송할 경우 어떻게 중계할지를 규정한다.
- 네트워크를 식별할 수 있는 다른 주소, 즉 IP 주소가 필요하다.
  - IP 주소는 어떤 네트워크의 어떤 컴퓨터인지 구분할 수 있도록 하는 주소이다.
- IP 헤더의 구성은? 
  - 헤더 길이 | 서비스 유형 | 전체 패킷 길이 | ID | 조각 상태 | 조각의 위치 | TTL | 프로토콜 | 헤더 체크섬 | 출발지 IP | 목적지 IP
- 관련 장비로 라우터, L3 스위치가 있다.

## 전송 계층: 세그먼트, 데이터그램
- 종단 간 신뢰할 수 있는 데이터를 전달하는 역할.
- 오류 검출 및 복구, 흐름 제어의 역할을 수행한다.
- 신뢰성과 효율성의 두 가지 특징을 가지고 조율한다. 전자는 TCP, 후자는 UDP.
- TCP로 전송할 때 붙이는 데이터를 TCP 헤더라고 하고, TCP 헤더가 붙은 데이터를 세그먼트라고 한다.
- UDP로 전송할 때는 UDP 헤더가 붙고, 데이터그램이라고 부른다.
- 데이터 전송을 위해 포트 번호를 사용한다.

### 번외 - TCP 방식의 연결(3-wqy handshake) 및 전송 과정
- TCP 방식이라면, 먼저 연결을 해야 한다. 이 과정에서 3-way handshake 방법을
  - 간단히 말하면, 연결 확립을 위해 패킷 요청을 세 번 교환하는 것이다.
- TCP 헤더의 코드 비트 부분에, 각각의 상태를 나타내는 비트가 6개 있다. 그 중 SYN과 ACK 비트를 사용한다.
  - 연결 확립을 위해 SYN 보내기 - 승인을 위한 ACK 보내면서 동시에 이쪽도 SYN 보내기 - 이쪽도 승인을 위핸 ACK 보내기 를 통해 통신이 성립된다.
- TCP는 데이터를 분할해서 보내는데, 고유한 일련번호인 Sequence Number가 있다.
  - 지금 보내는 이 데이터 조각이 몇 번째 데이터 조각인지 알려 주는 역할을 한다.
- 고유한 확인 번호인 Acknowledge Number는 수신 측이 몇 번째 데이터를 수신했는지 송신 측에 알려주는 역할을 한다. 
  - 다음 번호의 데이터를 요청하는 데에도 사용된다.

### 번외 - 4-way handshake
- 연결을 수립할 때 3-way handshake를 썼듯, 연결을 해제할 때는 4-way handshake를 사용한다.
- 4 way라는 이름이 알려 주듯, 네 번의 통신을 거친다. 또한 TCP 헤더 코드 비트 중 FIN과 ACK를 사용한다.
- 간단한 구조는 다음과 같다.
  1. 먼저 컴퓨터 1에서 컴퓨터 2로 종료 요청 FIN을 보낸다.
  2. 컴퓨터 2는 컴퓨터 1의 해당 요청을 확인했다는 의미로 ACK을 보낸다.
  3. 또한, 컴퓨터 2도 컴퓨터 1과 연결을 종료하기 위해 FIN을 보낸다.
  4. 컴퓨터 1은 컴퓨터 2의 해당 요청을 확인했다는 의미로 ACK을 보낸다. 이렇게 네 번의 통신이 이루어진다.
- 1의 과정에서, 컴퓨터 1은 사실상 ACK 비트도 함께 보낸다. 이를 Half-Close 기법이라고 하는데, 말 그대로 연결을 반만 닫는다는 뜻이다.
  - FIN과 함께 가는 ACK는 일종의 승인 번호로, 이 통신을 마지막으로 통신을 종료하고자 하지만 그래도 귀는 열어 두겠다~ 하는 의미이다.
  - 이후 수신자가 보낼 나머지 데이터를 다 보내고 FIN을 보냄으로써 확인하면, 비로소 나머지 반의 연결을 닫는 것이다.
- 2의 과정에서, 컴퓨터 2는 종료하고자 하는 것을 확인했다는 ACK를 보내며, 자신의 신호가 다 갈 때까지 기다린다. 이 때 ACK Number 필드를 (Sequence Number + 1)로 지정하고, ACK 플래그 비트를 1로 설정한 세그먼트를 전송한다.
  - 컴퓨터 1은 이제 컴퓨터 2에서 올 FIN을 기다리게 된다.
- 4의 과정에서 컴퓨터 1은 ACK를 보내기는 했지만, TIME_WAIT 상태에 들어가서 혹시 더 받아야 할 데이터가 있는지 기다리고, 해당 시간이 끝나면 연결을 종료하게 된다.

### 번외 - UDP의 전송 과정
- UDP 방식은 효율성을 중시하는 비연결형 통신이다. 
- UDP 헤더가 붙은 UDP 데이터그램을, 상대방을 확인하지 않고 연속해서 보낸다.
- 따라서 연결을 수립하는 3-way handshake라던지, 이후에도 연결을 계속 받으면서 ACK를 보낸다던지 하는, 신뢰성을 담보하기 위한 동작이 불필요해진다.
- 네트워크 상에 있는 장비들에게 일괄적으로 데이터를 보낼 수 있다는 장점도 있다. 이를 Broadcast라고 한다.
  - TCP라면, 통신하고자 하는 각 컴퓨터와 따로따로 연결을 수립해야 했을 것이다.
- 다만, UDP 방식도 올바른 목적지의 애플리케이션으로 데이터를 보내기 위한 최소한의 정보를 UDP 헤더에 기록해 두고 있다.
  - 보내는 쪽에서는 계속 보내고, 받는 쪽에서는 해당 데이터의 수신 대상이 자신인지만 확인하고 맞다면 데이터를 받아들이는 정도의 과정이 있을 수 있다.

## 세션 계층: 세션
- 통신 장치 간 상호작용 및 동기화를 제공한다.
- 연결 세션에서 데이터 교환과 에러 발생 시의 복구를 관리한다.
- "세션"이라 함은 네트워크 상에서의 하나의 주체, 와 같은 느낌으로 작동한다고 여겨진다.

## 표현 계층: 메시지
- 데이터를 어떻게 표현할지 정하는 역할을 하는 계층.
- 다음과 같은 역할을 수행한다. 
  - 송신자에서 온 데이터를 해석하기 위한 응용계층 데이터 부호화, 변화
  - 수신자에서 데이터의 압축을 풀수 있는 방식으로 된 데이터 압축 
  - 데이터의 암호화와 복호화
    - MIME 인코딩이나 암호화 등의 동작이 표현계층에서 이루어짐
    - EBCDIC로 인코딩된 파일을 ASCII 로 인코딩된 파일로 바꿔주는 것이 한가지 예

## 응용 계층: 데이터
- 사용자와 가장 밀접한 계층으로, 인터페이스 역할을 수행한다.
- 응용 프로세스 간의 정보 교환을 담당한다.
- 다양한 응용 프로그램을 통해 사용자는 어떤 것을 네트워크에 태울지 결정할 수 있다.
